<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Adventure Game Pro</title>
<style>
body {
    margin: 0;
    background: #111;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-family: Arial;
    color: white;
}
canvas {
    background: #2e8b57;
    border: 4px solid white;
}
#ui {
    position: absolute;
    top: 10px;
    text-align: center;
    width: 100%;
}
</style>
</head>
<body>

<div id="ui">
‚ù§Ô∏è Leben: <span id="lives">3</span> |
üèÜ Level: <span id="level">1</span>
</div>

<canvas id="game" width="700" height="450"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let level = 1;
let lives = 3;

const player = {
    x: 50,
    y: 200,
    size: 25,
    speed: 3,
    color: "blue"
};

let goal = {
    x: 650,
    y: 200,
    size: 30,
    color: "gold"
};

let obstacles = [];
let enemies = [];

function generateLevel() {
    obstacles = [];
    enemies = [];

    // Hindernisse
    for (let i = 0; i < level + 2; i++) {
        obstacles.push({
            x: Math.random() * 600 + 50,
            y: Math.random() * 350,
            width: 100,
            height: 20
        });
    }

    // Gegner
    for (let i = 0; i < level; i++) {
        enemies.push({
            x: Math.random() * 600 + 50,
            y: Math.random() * 350,
            size: 25,
            speed: 1 + level * 0.5,
            dx: Math.random() < 0.5 ? 1 : -1,
            dy: Math.random() < 0.5 ? 1 : -1
        });
    }

    player.x = 50;
    player.y = 200;
}

const keys = {};

document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

function collisionRect(a, b) {
    return (
        a.x < b.x + b.width &&
        a.x + a.size > b.x &&
        a.y < b.y + b.height &&
        a.y + a.size > b.y
    );
}

function collisionSquare(a, b) {
    return (
        a.x < b.x + b.size &&
        a.x + a.size > b.x &&
        a.y < b.y + b.size &&
        a.y + a.size > b.y
    );
}

function update() {

    let newX = player.x;
    let newY = player.y;

    if (keys["arrowup"] || keys["w"]) newY -= player.speed;
    if (keys["arrowdown"] || keys["s"]) newY += player.speed;
    if (keys["arrowleft"] || keys["a"]) newX -= player.speed;
    if (keys["arrowright"] || keys["d"]) newX += player.speed;

    // Kollision mit Hindernissen
    let future = {x:newX, y:player.y, size:player.size};
    if (!obstacles.some(o => collisionRect(future,o))) player.x = newX;

    future = {x:player.x, y:newY, size:player.size};
    if (!obstacles.some(o => collisionRect(future,o))) player.y = newY;

    // Spielfeld Begrenzung
    player.x = Math.max(0, Math.min(canvas.width - player.size, player.x));
    player.y = Math.max(0, Math.min(canvas.height - player.size, player.y));

    // Gegner Bewegung
    enemies.forEach(enemy => {
        enemy.x += enemy.dx * enemy.speed;
        enemy.y += enemy.dy * enemy.speed;

        if (enemy.x <= 0 || enemy.x >= canvas.width - enemy.size) enemy.dx *= -1;
        if (enemy.y <= 0 || enemy.y >= canvas.height - enemy.size) enemy.dy *= -1;

        if (collisionSquare(player, enemy)) {
            lives--;
            document.getElementById("lives").textContent = lives;
            player.x = 50;
            player.y = 200;

            if (lives <= 0) {
                alert("üíÄ Game Over!");
                level = 1;
                lives = 3;
                document.getElementById("level").textContent = level;
                document.getElementById("lives").textContent = lives;
                generateLevel();
            }
        }
    });

    // Ziel erreicht
    if (collisionSquare(player, goal)) {
        level++;
        document.getElementById("level").textContent = level;
        generateLevel();
    }
}

function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Hindernisse
    ctx.fillStyle = "brown";
    obstacles.forEach(o => ctx.fillRect(o.x,o.y,o.width,o.height));

    // Ziel
    ctx.fillStyle = goal.color;
    ctx.fillRect(goal.x,goal.y,goal.size,goal.size);

    // Gegner
    ctx.fillStyle = "red";
    enemies.forEach(e => ctx.fillRect(e.x,e.y,e.size,e.size));

    // Spieler
    ctx.fillStyle = player.color;
    ctx.fillRect(player.x,player.y,player.size,player.size);
}

function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}

generateLevel();
loop();
</script>

</body>
</html>
