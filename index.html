<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Trop Adventure - Explosion Edition</title>
<style>
body { margin:0; overflow:hidden; background:#6ec6ff; }
canvas { display:block; }

.button{
position:fixed;
bottom:20px;
width:60px;
height:60px;
background:rgba(0,0,0,0.4);
color:white;
font-size:30px;
text-align:center;
line-height:60px;
border-radius:50%;
user-select:none;
}
#left{ left:20px; }
#right{ left:100px; }
#jump{ right:40px; }
</style>
</head>
<body>

<canvas id="game"></canvas>

<div id="left" class="button">◀</div>
<div id="right" class="button">▶</div>
<div id="jump" class="button">▲</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let gravity = 0.7;
let keys = {left:false,right:false,jump:false};
let particles = [];

let player = {
x:100,
y:300,
w:30,
h:30,
dx:0,
dy:0,
grounded:false
};

let platforms = [
{x:0,y:450,w:300,h:50},
{x:350,y:400,w:200,h:20},
{x:600,y:350,w:200,h:20},
{x:900,y:420,w:200,h:20}
];

let enemy = {
x:1000,
y:380,
radius:20,
speed:1.5,
angle:0
};

let water = {y:500};

function drawBackground(){
ctx.fillStyle="#6ec6ff";
ctx.fillRect(0,0,canvas.width,canvas.height);

ctx.fillStyle="#00aaff";
ctx.fillRect(0,water.y,canvas.width,200);
}

function drawPlatforms(){
ctx.fillStyle="#228B22";
platforms.forEach(p=>{
ctx.fillRect(p.x,p.y,p.w,p.h);
});
}

function drawPlayer(){
ctx.fillStyle="black";
ctx.fillRect(player.x,player.y,player.w,player.h);
}

function drawEnemy(){
ctx.save();
ctx.translate(enemy.x,enemy.y);
ctx.rotate(enemy.angle);

ctx.fillStyle="purple";
ctx.beginPath();
ctx.arc(0,0,enemy.radius,0,Math.PI*2);
ctx.fill();

ctx.strokeStyle="red";
for(let i=0;i<10;i++){
let a=i*(Math.PI*2/10);
let x1=Math.cos(a)*enemy.radius;
let y1=Math.sin(a)*enemy.radius;
let x2=Math.cos(a)*(enemy.radius+10);
let y2=Math.sin(a)*(enemy.radius+10);
ctx.beginPath();
ctx.moveTo(x1,y1);
ctx.lineTo(x2,y2);
ctx.stroke();
}

ctx.restore();
}

function createExplosion(x,y){
for(let i=0;i<30;i++){
particles.push({
x:x,
y:y,
dx:(Math.random()-0.5)*6,
dy:(Math.random()-0.5)*6,
life:60
});
}
}

function drawParticles(){
ctx.fillStyle="orange";
particles.forEach(p=>{
ctx.fillRect(p.x,p.y,4,4);
});
}

function updateParticles(){
particles.forEach(p=>{
p.x+=p.dx;
p.y+=p.dy;
p.life--;
});
particles=particles.filter(p=>p.life>0);
}

function update(){

player.dy+=gravity;

if(keys.left) player.dx=-5;
else if(keys.right) player.dx=5;
else player.dx=0;

player.x+=player.dx;
player.y+=player.dy;

player.grounded=false;

platforms.forEach(p=>{
if(player.x < p.x+p.w &&
player.x+player.w > p.x &&
player.y+player.h > p.y &&
player.y+player.h < p.y+20){
player.y=p.y-player.h;
player.dy=0;
player.grounded=true;
}
});

if(keys.jump && player.grounded){
player.dy=-14;
}

if(player.x < enemy.x) enemy.x-=enemy.speed;
if(player.x > enemy.x) enemy.x+=enemy.speed;

enemy.angle+=0.1;

let dx = player.x+player.w/2-enemy.x;
let dy = player.y+player.h/2-enemy.y;
let dist = Math.sqrt(dx*dx+dy*dy);

if(dist < enemy.radius+player.w/2){
createExplosion(player.x,player.y);
reset();
}

if(player.y > water.y){
createExplosion(player.x,player.y);
reset();
}
}

function reset(){
player.x=100;
player.y=300;
player.dy=0;
}

function loop(){
ctx.clearRect(0,0,canvas.width,canvas.height);
drawBackground();
drawPlatforms();
drawEnemy();
drawPlayer();
drawParticles();
update();
updateParticles();
requestAnimationFrame(loop);
}

document.getElementById("left").ontouchstart=()=>keys.left=true;
document.getElementById("left").ontouchend=()=>keys.left=false;

document.getElementById("right").ontouchstart=()=>keys.right=true;
document.getElementById("right").ontouchend=()=>keys.right=false;

document.getElementById("jump").ontouchstart=()=>keys.jump=true;
document.getElementById("jump").ontouchend=()=>keys.jump=false;

loop();
</script>

</body>
</html>
